# План реализации системы загрузки и обработки банковских выписок

## Общая информация

**Цель проекта:** Создание веб-приложения для автоматической загрузки, обработки и структурирования банковских выписок с интеграцией в Google Sheets и автоматической отправкой отчётов в Telegram.

**Ориентировочный срок:** 7-9 дней разработки

---

## Этап 1: Настройка инфраструктуры и базовая архитектура (1 день)

### 1.1. Инициализация проекта

- [ ] Создание структуры проекта (monorepo или раздельные репозитории)
- [ ] Настройка package.json для frontend и backend
- [ ] Настройка TypeScript конфигурации
- [ ] Настройка Biome
- [ ] Настройка Git и .gitignore
- [ ] Создание базовой структуры директорий

### 1.2. Backend инфраструктура

- [ ] Инициализация Nest.js проекта
- [ ] Настройка модульной архитектуры (modules, controllers, services)
- [ ] Настройка многослойной архитектуры:
  - [ ] Клиентский слой (Frontend) - работает только через REST API, использует JWT
  - [ ] API-слой (Backend / API Gateway) - принимает запросы фронта и Telegram-бота, обрабатывает аутентификацию
  - [ ] Сервисный / доменный слой - парсинг, классификация, генерация отчётов
  - [ ] Слой интеграций - клиенты для Google Sheets, Google Drive, Telegram с retry механизмами
  - [ ] Слой хранения данных - PostgreSQL с миграциями
  - [ ] Фоновые задачи (workers) - асинхронный парсинг, генерация отчётов, отправка Telegram
  - [ ] Telegram-слой - обработка команд, загрузка файлов, отправка отчётов
- [ ] Настройка версионирования API (/api/v1)
- [ ] Настройка подключения к базе данных (PostgreSQL)
- [ ] Настройка миграций (TypeORM или Prisma)
- [ ] Настройка переменных окружения (.env)
- [ ] Настройка структурированного логирования (JSON формат):
  - [ ] Поля: timestamp, level, service, user_id, statement_id, correlation_id, message, details
  - [ ] Логирование ключевых событий (загрузка, парсинг, ошибки, отчёты)
- [ ] Настройка валидации (class-validator, class-transformer)
- [ ] Настройка обработки ошибок (exception filters)
- [ ] Настройка очередей задач (BullMQ / Redis) для фоновых задач

### 1.3. Frontend инфраструктура

- [ ] Инициализация Next.js проекта (или React)
- [ ] Настройка структуры директорий (components, pages, hooks, utils)
- [ ] Настройка UI библиотеки (Material-UI или Ant Design)
- [ ] Настройка управления состоянием (Redux Toolkit или Zustand)
- [ ] Настройка HTTP клиента (axios)
- [ ] Настройка роутинга
- [ ] Настройка переменных окружения

### 1.4. База данных

- [ ] Создание схемы базы данных
- [ ] Создание миграций для всех сущностей:
  - [ ] User
  - [ ] Statement (с полем file_hash для идемпотентности)
  - [ ] Transaction
  - [ ] Category
  - [ ] Branch
  - [ ] Wallet
  - [ ] GoogleSheet
  - [ ] TelegramReport
  - [ ] ParsingRule
  - [ ] AuditLog (для аудита действий пользователей)
- [ ] Настройка индексов для оптимизации запросов
- [ ] Создание seed данных для тестирования

### 1.5. CI/CD и развёртывание

- [ ] Настройка Docker (опционально)
- [ ] Настройка GitHub Actions или аналогичного CI/CD
- [ ] Подготовка конфигурации для деплоя (Vercel для frontend, Render/Railway для backend)

**Результат этапа:** Готовая инфраструктура проекта с настроенной базой данных и базовой архитектурой.

---

## Этап 2: Система аутентификации и авторизации (0.5 дня)

### 2.1. Backend - Auth модуль

- [ ] Реализация JWT стратегии:
  - [ ] Access token (HS256/RS256, срок 1 час, payload: sub, email, role, iat, exp, jti)
  - [ ] Refresh token (срок 30 дней, payload: sub, type: "refresh", iat, exp, jti)
- [ ] Создание AuthController с endpoints:
  - [ ] POST /auth/register
  - [ ] POST /auth/login (с rate limiting)
  - [ ] POST /auth/refresh
  - [ ] POST /auth/logout (деактивация refresh_token)
- [ ] Реализация OAuth 2.0 для Google:
  - [ ] GET /auth/google
  - [ ] GET /auth/google/callback
- [ ] Реализация guards для защиты роутов
- [ ] Реализация декораторов для получения текущего пользователя
- [ ] Хеширование паролей (bcrypt)
- [ ] Валидация входных данных
- [ ] Настройка HTTPS только для production
- [ ] Возможность ревокации refresh токенов

### 2.2. Frontend - Auth страницы

- [ ] Страница регистрации (/register)
- [ ] Страница входа (/login)
- [ ] Интеграция с Google OAuth
- [ ] Обработка токенов (сохранение в localStorage/cookies)
- [ ] Реализация защищённых роутов (middleware)
- [ ] Компонент выхода из системы

### 2.3. Управление пользователями

- [ ] CRUD операции для пользователей (для админов)
- [ ] Управление ролями (admin, user, viewer)
- [ ] Профиль пользователя

**Результат этапа:** Работающая система аутентификации с поддержкой JWT и OAuth.

---

## Этап 3: Модуль загрузки файлов (1 день)

### 3.1. Backend - File Upload

- [ ] Настройка multer для загрузки файлов
- [ ] Реализация POST /statements/upload endpoint:
  - [ ] Поддержка заголовка Idempotency-Key для идемпотентности
  - [ ] Вычисление file_hash (SHA-256 от бинарного содержимого)
  - [ ] Проверка дубликатов по file_hash + account_number + период
  - [ ] Возврат существующего Statement при дубликате
- [ ] Валидация типов файлов (PDF, XLSX, CSV, JPG, PNG)
- [ ] Валидация размера файлов (максимум 10MB)
- [ ] Сохранение файлов в файловую систему или облачное хранилище
- [ ] Создание записи Statement в БД со статусом "uploaded" (с file_hash)
- [ ] Обработка множественной загрузки (до 2 файлов)
- [ ] Обработка ошибок загрузки
- [ ] Запись в аудит-лог при загрузке файла

### 3.2. Frontend - Upload страница

- [ ] Создание страницы /upload
- [ ] Компонент выбора Google Sheet (выпадающий список)
- [ ] Компонент выбора проекта / кошелька / филиала (по согласованию)
- [ ] Компонент drag-and-drop для загрузки файлов
- [ ] Валидация файлов на клиенте
- [ ] Индикация прогресса загрузки
- [ ] Отображение статуса обработки:
  - [ ] загружено
  - [ ] в обработке
  - [ ] обработано
  - [ ] ошибка
- [ ] Обработка ошибок загрузки
- [ ] Поддержка загрузки до 2 файлов одновременно

### 3.3. Интеграция с Google Sheets API

- [ ] Настройка Google API клиента
- [ ] Реализация OAuth для Google Sheets
- [ ] Создание модуля GoogleSheetsService (слой интеграций)
- [ ] Endpoints для управления Google Sheets:
  - [ ] POST /google-sheets/connect
  - [ ] GET /google-sheets
  - [ ] PUT /google-sheets/:id/sync
  - [ ] DELETE /google-sheets/:id
- [ ] Сохранение токенов доступа (шифрование)
- [ ] Интеграция с Google Drive API для хранения загруженных файлов

**Результат этапа:** Работающая система загрузки файлов с интеграцией Google Sheets.

---

## Этап 4: Модуль парсинга PDF выписок (2 дня)

### 4.1. Парсинг PDF - Bereke Bank (новый формат)

- [ ] Установка библиотек для работы с PDF (pdf-parse, pdf-table-extract)
- [ ] Создание парсера для нового формата Bereke Bank
- [ ] Извлечение метаданных выписки:
  - [ ] Номер счёта
  - [ ] Период выписки (дата начала и конца)
  - [ ] Остаток на начало и конец периода
- [ ] Извлечение табличных данных:
  - [ ] Дата операции
  - [ ] Номер документа
  - [ ] Наименование контрагента
  - [ ] БИН/номер счёта контрагента
  - [ ] Реквизиты банка контрагента
  - [ ] Дебет
  - [ ] Кредит
  - [ ] Назначение платежа
  - [ ] Валюта (если присутствует)
- [ ] Нормализация чисел:
  - [ ] Замена запятой на точку
  - [ ] Удаление разделителей тысяч
  - [ ] Приведение к числовым типам
- [ ] Валидация извлечённых данных
- [ ] Преобразование в структурированный JSON
- [ ] Тестирование на референсных файлах

### 4.2. Парсинг PDF - Bereke Bank (старый формат)

- [ ] Создание парсера для старого формата
- [ ] Автоматическое определение структуры таблицы
- [ ] Обработка вариативных колонок
- [ ] Обработка отсутствующих колонок
- [ ] Тестирование на statement-316.pdf и statement-317.pdf
- [ ] Определение версии формата автоматически

### 4.3. Парсинг Excel и CSV

- [ ] Установка библиотек (xlsx, csv-parser)
- [ ] Создание парсера для XLS/XLSX
- [ ] Создание парсера для CSV (автоопределение разделителя)
- [ ] Маппинг колонок на структуру Transaction
- [ ] Валидация данных

### 4.4. OCR модуль (опционально)

- [ ] Интеграция Tesseract.js для базового OCR
- [ ] Предобработка изображений (контраст, резкость)
- [ ] Распознавание текста из JPG/PNG
- [ ] Определение табличной структуры
- [ ] Извлечение данных операций
- [ ] Интеграция Google Vision API (опционально)

### 4.5. Обработка выписок

- [ ] Создание сервиса StatementProcessingService
- [ ] Настройка фоновых задач (workers):
  - [ ] Интеграция BullMQ / Redis для очередей
  - [ ] Создание job для парсинга файлов
  - [ ] Создание job для генерации отчётов
  - [ ] Создание job для отправки Telegram сообщений
- [ ] Асинхронная обработка файлов через очередь задач
- [ ] Определение типа банка и формата автоматически
- [ ] Выбор соответствующего парсера
- [ ] Создание записей Transaction в БД
- [ ] Обновление статуса Statement (processing → parsed → validated)
- [ ] Обработка ошибок парсинга
- [ ] Структурированное логирование процесса обработки:
  - [ ] Логирование старта/конца парсинга
  - [ ] Логирование ошибок с correlation_id
  - [ ] Логирование метрик времени обработки

### 4.6. Правила парсинга (ParsingRule)

- [ ] Создание системы правил парсинга
- [ ] Хранение правил в БД (JSON структура)
- [ ] Возможность редактирования правил через API
- [ ] Применение правил при парсинге

**Результат этапа:** Работающий парсинг всех форматов выписок с автоматическим определением типа.

---

## Этап 5: Модуль автоматической классификации (1 день)

### 5.1. Классификация операций

- [ ] Определение типа операции (income/expense) на основе дебета/кредита
- [ ] Автоматическое определение категории на основе:
  - [ ] Наименования контрагента
  - [ ] Назначения платежа (например, шаблон "Kaspi Red" → категория "Платежи Kaspi Red")
  - [ ] Суммы операции
  - [ ] Исторических данных
- [ ] Создание системы правил классификации
- [ ] Машинное обучение для улучшения классификации (опционально)
- [ ] Запись в аудит-лог при изменении категорий

### 5.2. Определение дополнительных полей

- [ ] Автоматическое определение филиала
- [ ] Автоматическое определение кошелька (счёта)
- [ ] Определение валюты операции
- [ ] Извлечение обменного курса (если есть в выписке)
- [ ] Определение статьи учёта
- [ ] Определение вида деятельности

### 5.3. Справочники

- [ ] CRUD для категорий (Categories)
- [ ] CRUD для филиалов (Branches)
- [ ] CRUD для кошельков (Wallets)
- [ ] Древовидная структура категорий (подкатегории)
- [ ] Системные категории по умолчанию

### 5.4. API для классификации

- [ ] Endpoint для ручной классификации операции
- [ ] Endpoint для массовой классификации
- [ ] Endpoint для обучения правил классификации

**Результат этапа:** Автоматическая классификация операций с возможностью ручной корректировки.

---

## Этап 6: Интерфейс редактирования данных (1 день)

### 6.1. Backend - Transactions API

- [ ] GET /transactions (список с фильтрацией и пагинацией)
- [ ] GET /transactions/:id (детальная информация)
- [ ] PUT /transactions/:id (обновление операции)
- [ ] DELETE /transactions/:id (удаление операции)
- [ ] POST /transactions/bulk-update (массовое обновление)
- [ ] Валидация данных при обновлении

### 6.2. Frontend - Страница редактирования

- [ ] Создание страницы /statements/:id/edit
- [ ] Таблица с распознанными транзакциями
- [ ] Возможность редактирования полей:
  - [ ] Дата операции
  - [ ] Контрагент
  - [ ] Сумма
  - [ ] Категория (выбор из справочника)
  - [ ] Филиал (выбор из справочника)
  - [ ] Кошелёк (выбор из справочника)
  - [ ] Статья учёта
  - [ ] Комментарии
- [ ] Удаление записей
- [ ] Массовое редактирование (выбор нескольких записей)
- [ ] Валидация данных на клиенте
- [ ] Сохранение изменений
- [ ] Индикация несохранённых изменений

### 6.3. Управление справочниками

- [ ] Страница управления категориями (/categories)
- [ ] Страница управления филиалами (/branches)
- [ ] Страница управления кошельками (/wallets)
- [ ] CRUD операции для всех справочников

**Результат этапа:** Полнофункциональный интерфейс для редактирования распознанных данных.

---

## Этап 7: Интеграция с Google Sheets - запись данных (1 день)

### 7.1. Запись данных в Google Sheets

- [ ] Реализация записи транзакций в Google Sheet
- [ ] Маппинг полей Transaction на колонки таблицы:
  - [ ] Месяц (текстовое представление)
  - [ ] Год
  - [ ] Месяц (числовое представление)
  - [ ] Дата операции
  - [ ] Сумма в тенге
  - [ ] Сумма в альтернативной валюте
  - [ ] Код валюты
  - [ ] Обменный курс
  - [ ] Кошелёк
  - [ ] Филиал
  - [ ] Статья учёта
  - [ ] Контрагент
  - [ ] Назначение платежа
  - [ ] Комментарии
  - [ ] Вид деятельности
  - [ ] Тип операции
  - [ ] Курсы USD и RUB
- [ ] Сохранение форматирования таблицы
- [ ] Добавление данных без перезаписи существующих
- [ ] Обработка ошибок доступа
- [ ] Повторные попытки при ошибках
- [ ] Логирование операций записи

### 7.2. Синхронизация данных

- [ ] Endpoint для ручной синхронизации
- [ ] Автоматическая синхронизация после обработки выписки
- [ ] Отслеживание последней синхронизации
- [ ] Обработка конфликтов данных

### 7.3. Тестирование интеграции

- [ ] Тестирование на реальной таблице заказчика
- [ ] Проверка соответствия структуры
- [ ] Проверка сохранения форматирования
- [ ] Проверка обработки ошибок

**Результат этапа:** Полная интеграция с Google Sheets с автоматической записью данных.

---

## Этап 8: Система отчётов (1 день)

### 8.1. Backend - Reports API

- [ ] Реализация ежедневных отчётов:
  - [ ] GET /reports/daily
  - [ ] Блок "Приходы за день" (общая сумма, количество операций, топ контрагентов)
  - [ ] Блок "Расходы за день" (общая сумма, количество операций, топ категорий)
  - [ ] Блок "Итоги дня" (разница приход-расход, остаток при наличии)
- [ ] Реализация месячных отчётов:
  - [ ] GET /reports/monthly
  - [ ] Динамика поступлений и расходов по дням
  - [ ] Распределение по категориям
  - [ ] Распределение по контрагентам
  - [ ] Сравнение с предыдущим периодом
- [ ] Пользовательские отчёты:
  - [ ] POST /reports/custom
  - [ ] Группировка данных (по категории, контрагенту, филиалу)
  - [ ] Фильтрация по произвольному периоду
  - [ ] Идемпотентность: ключ (user_id, report_type, report_date)
- [ ] Экспорт отчётов:
  - [ ] POST /reports/export (Excel)
  - [ ] Экспорт в CSV
- [ ] Запись в аудит-лог при ручных запусках отчётов

### 8.2. Frontend - Отчёты

- [ ] Страница отчётов (/reports)
- [ ] Компонент ежедневного отчёта
- [ ] Компонент месячного отчёта
- [ ] Компонент пользовательского отчёта
- [ ] Визуализация данных (графики, диаграммы)
- [ ] Экспорт отчётов
- [ ] Фильтры и параметры отчётов

### 8.3. Административная панель

- [ ] Страница администратора (/admin)
- [ ] Журнал загруженных выписок (фильтры, поиск)
- [ ] История обработки файлов и статусы
- [ ] Фильтрация и поиск
- [ ] Просмотр ошибок обработки
- [ ] Возможность повторной обработки
- [ ] Управление правилами распознавания (ParsingRule)
- [ ] Просмотр и экспорт отчётов (Excel, CSV)
- [ ] Просмотр аудит-лога действий пользователей

**Результат этапа:** Полнофункциональная система отчётов с административной панелью.

---

## Этап 9: Telegram интеграция (1 день)

### 9.1. Telegram Bot

- [ ] Создание Telegram бота (Telegram-слой)
- [ ] Настройка webhook или long polling
- [ ] Реализация команд бота:
  - [ ] /start - приветствие
  - [ ] /help - справка
  - [ ] /upload - загрузка файла
  - [ ] /report - запрос отчёта (за день/месяц)
- [ ] Приём PDF файлов от пользователей
- [ ] Автоматическая обработка полученных файлов
- [ ] Отправка результатов обработки в административную группу
- [ ] Уведомления об ошибках обработки
- [ ] Интеграция с API-слоем через REST API

### 9.2. Автоматические отчёты в Telegram

- [ ] Настройка расписания отправки отчётов (cron через фоновые задачи)
- [ ] Ежедневные отчёты:
  - [ ] Формирование отчёта за день
  - [ ] Форматирование сообщения
  - [ ] Отправка в административную группу
  - [ ] Идемпотентность: повторный запрос за тот же день возвращает существующий отчёт
- [ ] Месячные отчёты:
  - [ ] Автоматическая отправка в конце месяца
  - [ ] Форматирование данных
  - [ ] Идемпотентность по ключу (user_id, report_type, report_date)
- [ ] Обработка ошибок отправки (retry механизмы)
- [ ] Логирование отправленных отчётов (структурированные логи)

### 9.3. Backend - Telegram API

- [ ] POST /telegram/connect (подключение Telegram аккаунта)
- [ ] GET /telegram/reports (история отчётов)
- [ ] POST /telegram/send-report (ручная отправка)
- [ ] Хранение chat_id и telegram_id пользователей

### 9.4. Frontend - Telegram настройки

- [ ] Страница настройки Telegram (/settings/telegram)
- [ ] Подключение Telegram аккаунта
- [ ] Настройка расписания отчётов
- [ ] Просмотр истории отправленных отчётов

**Результат этапа:** Работающий Telegram бот с автоматической отправкой отчётов.

---

## Этап 10: Тестирование и оптимизация (1-2 дня)

### 10.1. Unit тесты

- [ ] Тесты для парсеров PDF
- [ ] Тесты для модуля классификации
- [ ] Тесты для API endpoints
- [ ] Тесты для бизнес-логики

### 10.2. Integration тесты

- [ ] Тесты интеграции с Google Sheets API
- [ ] Тесты интеграции с Telegram Bot API
- [ ] Тесты обработки файлов end-to-end

### 10.3. E2E тесты

- [ ] Тесты основных сценариев использования
- [ ] Тесты загрузки и обработки выписок
- [ ] Тесты редактирования данных

### 10.4. Оптимизация производительности

- [ ] Оптимизация запросов к БД (индексы, запросы)
- [ ] Оптимизация парсинга PDF (кеширование, параллельная обработка)
- [ ] Оптимизация фронтенда (lazy loading, code splitting)
- [ ] Настройка rate limiting:
  - [ ] Лимит для неавторизованных: 100/час по IP
  - [ ] Лимит для авторизованных: 1000/час
  - [ ] Заголовки ответа: X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset
- [ ] Мониторинг производительности
- [ ] Настройка метрик:
  - [ ] Время обработки файла
  - [ ] Количество успешно обработанных и упавших выписок
  - [ ] Количество отправленных Telegram-отчётов
  - [ ] Время ответа API

### 10.5. Обработка ошибок

- [ ] Улучшение обработки ошибок на всех уровнях
- [ ] Структурированное логирование ошибок (JSON формат)
- [ ] Уведомления об критических ошибках
- [ ] Retry механизмы для внешних API (Google Sheets, Telegram):
  - [ ] Обработка сетевых сбоев
  - [ ] Обработка rate limits
  - [ ] Экспоненциальная задержка при повторах
- [ ] Единый формат ошибок API:
  - [ ] Коды: 200, 201, 204, 400, 401, 403, 404, 422, 429, 500
  - [ ] Формат: { error: { code, message, details } }

### 10.6. Безопасность

- [ ] Проверка безопасности API (валидация, санитизация)
- [ ] Защита от SQL инъекций
- [ ] Защита от XSS
- [ ] Настройка CORS
- [ ] Проверка прав доступа
- [ ] Хранение секретов в защищённых переменных окружения
- [ ] Шифрование токенов доступа (Google Sheets, Telegram)

### 10.7. Observability и мониторинг

- [ ] Настройка структурированного логирования (JSON):
  - [ ] Поля: timestamp, level, service, user_id, statement_id, correlation_id, message, details
  - [ ] Логирование всех ключевых событий
- [ ] Настройка метрик:
  - [ ] Время обработки файла
  - [ ] Количество успешно обработанных и упавших выписок
  - [ ] Количество отправленных Telegram-отчётов
  - [ ] Время ответа API
- [ ] Настройка трейсинга (опционально):
  - [ ] Поддержка OpenTelemetry / Jaeger
  - [ ] Корреляция логов и запросов по correlation_id
- [ ] Настройка алертов (опционально):
  - [ ] Уведомления при росте ошибок парсинга
  - [ ] Уведомления при недоступности интеграций
  - [ ] Уведомления при деградации времени ответа
- [ ] Реализация аудит-лога:
  - [ ] Запись действий пользователей (загрузка/удаление выписок)
  - [ ] Запись изменений категорий, кошельков, филиалов
  - [ ] Запись ручных запусков отчётов
  - [ ] Таблица AuditLog в БД

**Результат этапа:** Протестированная и оптимизированная система с полным мониторингом.

---

## Этап 11: Документация и финализация (0.5 дня)

### 11.1. Техническая документация

- [ ] Документация API (Swagger/OpenAPI):
  - [ ] Все endpoints с описанием параметров
  - [ ] Примеры запросов и ответов
  - [ ] Коды ошибок и их описания
  - [ ] Формат JWT токенов
  - [ ] Требования к идемпотентности
- [ ] Документация архитектуры:
  - [ ] Описание многослойной архитектуры
  - [ ] Диаграммы взаимодействия компонентов
  - [ ] Описание фоновых задач и очередей
- [ ] Документация развёртывания:
  - [ ] Инструкции для production окружения
  - [ ] Настройка переменных окружения
  - [ ] Настройка мониторинга и алертов
- [ ] README с инструкциями по установке

### 11.2. Пользовательская документация

- [ ] Инструкция по использованию веб-интерфейса
- [ ] Инструкция по настройке Google Sheets
- [ ] Инструкция по использованию Telegram бота
- [ ] FAQ

### 11.3. Подготовка к деплою

- [ ] Настройка production окружения
- [ ] Настройка переменных окружения
- [ ] Настройка мониторинга и логирования
- [ ] Резервное копирование БД
- [ ] Деплой на production серверы

**Результат этапа:** Полностью готовая к эксплуатации система с документацией.

---

## Дополнительные задачи (опционально, по необходимости)

### Расширение функционала

- [ ] Поддержка формата Kaspi Bank (модульная архитектура позволяет добавить без изменения ядра)
- [ ] Улучшение OCR (интеграция Google Vision API)
- [ ] Машинное обучение для классификации
- [ ] Реализация Webhooks:
  - [ ] События: statement.uploaded, statement.processed, statement.failed, transaction.created, transaction.updated, report.generated
  - [ ] Формат payload: { event, timestamp, data }
  - [ ] Идемпотентность webhooks (ключ: event, external_id, timestamp)
- [ ] Мобильное приложение
- [ ] Расширенная аналитика

### Улучшения UX

- [ ] Темная тема
- [ ] Мультиязычность
- [ ] Улучшенная визуализация данных
- [ ] Drag-and-drop для редактирования категорий

---

## Приоритизация задач

### Критический путь (MVP)

1. Этап 1: Инфраструктура
2. Этап 2: Аутентификация
3. Этап 3: Загрузка файлов
4. Этап 4: Парсинг PDF (Bereke Bank)
5. Этап 5: Классификация
6. Этап 7: Запись в Google Sheets
7. Этап 6: Редактирование данных

### Вторая очередь

8. Этап 8: Отчёты
9. Этап 9: Telegram интеграция

### Третья очередь

10. Этап 10: Тестирование
11. Этап 11: Документация

---

## Оценка времени

| Этап               | Время   | Приоритет   |
| ------------------ | ------- | ----------- |
| 1. Инфраструктура  | 1 день  | Критический |
| 2. Аутентификация  | 0.5 дня | Критический |
| 3. Загрузка файлов | 1 день  | Критический |
| 4. Парсинг PDF     | 2 дня   | Критический |
| 5. Классификация   | 1 день  | Критический |
| 6. Редактирование  | 1 день  | Критический |
| 7. Google Sheets   | 1 день  | Критический |
| 8. Отчёты          | 1 день  | Высокий     |
| 9. Telegram        | 1 день  | Высокий     |
| 10. Тестирование   | 1-2 дня | Средний     |
| 11. Документация   | 0.5 дня | Средний     |

**Итого:** 10.5-11.5 дней разработки

---

## Риски и митигация

### Технические риски

1. **Сложность парсинга PDF** - различные форматы выписок

   - Митигация: модульная архитектура парсеров, тестирование на реальных файлах

2. **Интеграция с Google Sheets API** - ограничения API, квоты

   - Митигация: обработка ошибок, retry механизмы, кеширование

3. **Производительность обработки** - большие файлы, медленный парсинг
   - Митигация: асинхронная обработка, очередь задач, оптимизация алгоритмов

### Бизнес-риски

1. **Изменение требований** - новые форматы выписок

   - Митигация: гибкая архитектура, модульность

2. **Недостаточное тестирование** - ошибки в production
   - Митигация: комплексное тестирование, staging окружение

---

## Метрики успеха

- [ ] Успешная обработка всех форматов выписок Bereke Bank
- [ ] Время обработки одного PDF < 30 секунд
- [ ] Точность распознавания > 95%
- [ ] Успешная интеграция с Google Sheets
- [ ] Работающие автоматические отчёты в Telegram
- [ ] Доступность системы > 99.5%
