# Что добавить в CI/CD для идеального деплоя без человека

Ниже — список конкретных пунктов, которых сейчас нет или они не закреплены как обязательные “quality gates”. Это нужно добавить в CI/CD, чтобы деплой был полностью автоматизированным и качественным.

## CI (проверки на PR/merge)

- [ ] **Monorepo-линт + форматирование**
  - [x] Запуск линтера для backend и frontend в CI.
  - [ ] Проверка форматирования (Prettier/biome) как обязательный шаг.
- [ ] **Типизация**
  - [ ] `tsc --noEmit` для backend и frontend как отдельный шаг.
- [x] **Unit/integration тесты**
  - [x] Backend unit тесты в CI.
  - [ ] Backend integration тесты в CI.
  - [ ] Frontend unit тесты — базовый smoke-набор.
- [ ] **E2E тесты (минимум критический путь)**
  - Логин/авторизация, загрузка файла, запуск парсинга, экспорт/интеграция.
- [ ] **Проверка миграций**
  - Прогон миграций на чистой БД в CI (docker-compose) + быстрый rollback тест.
- [x] **Сборка Docker-образа**
  - Собирается образ по Dockerfile (job `docker-build`).
- [ ] **Зависимости и уязвимости**
  - `npm audit` в режиме CI или аналог (Snyk/Dependabot).
  - Блокировать PR при критических уязвимостях.
- [ ] **Лицензии зависимостей**
  - Проверка несовместимых лицензий (особенно для коммерческого использования).
- [ ] **Coverage gate**
  - Минимальный порог покрытия для backend (и фронта, если есть).
- [ ] **CodeQL/Static анализ**
  - Анализ безопасности кода на PR и по расписанию.

## CD (деплой и релизы)

- [ ] **Стейджинг-окружение обязательно**
  - Автодеплой из `develop/staging`.
  - После успешных тестов — автоматический promote на production.
- [ ] **Preview окружения для PR**
  - Изолированные окружения для каждой ветки/PR (по возможности).
- [ ] **Авто-версионирование и release notes**
  - Semver по тегам и автогенерация release notes.
- [ ] **Авто-откат (rollback)**
  - Авто-откат при падении healthcheck/росте 5xx после деплоя.
- [ ] **One-off job для миграций**
  - Миграции как отдельный шаг, чтобы избежать гонок при масштабировании.
- [ ] **DB backup перед миграцией**
  - Автоматический snapshot/backup для prod перед изменениями схемы.

## Качество и надежность

- [ ] **Smoke тесты после деплоя**
  - Минимальный набор проверок на живом окружении.
- [ ] **Readiness/Liveness checks**
  - Отдельные эндпоинты: `readiness` проверяет БД/redis, `liveness` — только процесс.
- [ ] **Rate-limits и защитные заглушки**
  - На критических API включить лимиты и throttling.
- [ ] **Feature flags**
  - Включение рискованных функций через флаги.

## Безопасность

- [ ] **Secrets scanning**
  - Скан секретов в git (git-secrets/TruffleHog).
- [ ] **SBOM**
  - Генерация SBOM при сборке и хранение как артефакт.
- [ ] **Policy-as-code**
  - Блокировка деплоя при нарушении security policy.

## Наблюдаемость

- [ ] **Deploy markers**
  - Маркеры деплоя в логах/метриках.
- [ ] **Алерты на деградации**
  - Рост 5xx, деградация latency, падение healthcheck.
- [ ] **SLO/SLI мониторинг**
  - Слежение за ошибками и временем ответа.

## Управление процессом

- [ ] **Обязательные статусы CI в правилах репозитория**
  - Merge в `main` запрещён без зелёных checks.
- [ ] **Защита веток**
  - Требование review + статусные проверки.
- [ ] **Подпись коммитов и релизов**
  - Подписанные теги релизов и коммиты.
